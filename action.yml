name: 'Export MermaidJS erdiagrams from database'
description: 'Exports MermaidJS entity relationship diagrams from existing databases'
inputs:
  output:
    description: 'output file'
    required: false
    default: erdiagram.svg
  config:
    description: 'path to Mermerd config file'
    required: true
  connectionString:
    description: 'connectionString'
    required: true
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - name: Download and extract Mermerd
      shell: bash
      run: wget -c https://github.com/KarnerTh/mermerd/releases/download/v0.7.0/mermerd_0.7.0_linux_amd64.tar.gz -O - | \
        tar -xz -C mermerd/
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: 18.15.0
    - name: Install mermaid-cli
      shell: bash
      run: npm install -g @mermaid-js/mermaid-cli
    - name: Generate Mermaid ER diagram
      shell: bash
      run: mermerd/mermerd --runConfig ${{ inputs.config }} -c ${{ inputs.connectionString }} -o erdiagram.mmd
    - name: Convert .mmd to .svg
      shell: bash
      run: mmdc -i erdiagram.mmd -o ${{ inputs.output }}
